name: 'E2E UI Test'

pr: none
trigger:
  - master
  - outsystems

pool:
  vmImage: "ubuntu-20.04"

resources:
  repositories:
    - repository: mobile-ui-tests
      type: github
      ref: feat/custom-working-directory
      name: OutSystems/mobile-ui-tests
      endpoint: OutSystems

stages:
  - stage: Run Camera E2E Tests on Android
    jobs: 
    - job: checkout_repos
      steps:
      - checkout: self
      - checkout: mobile-ui-tests
    - template: pipelines/templates/plugins_variables.yml@mobile-ui-tests
      parameters:
        pluginName: camera
    - template: pipelines/templates/build-and-execute-tests-template.yml@mobile-ui-tests
      parameters:
        PACKAGE: $(ANDROID_PACKAGE_ID)
        MABS: 9
        DATACENTER: eu
        DEVICE: 'samsung or google'
        DEVICE_PLATFORM: Android
        DEVICE_VERSION: 11
        PLATFORM_TYPE: Mobile
        PLUGIN: camera
        TAGS: '@p0'
        RETRY: 1
        TEST_TYPE: native
        THREADS: 3
        WORKING_DIR: $(System.DefaultWorkingDirectory)/mobile-ui-tests